# 迪士尼RAG知识库使用指南

## 📋 项目概述

本项目成功搭建了迪士尼RAG（检索增强生成）知识库系统，支持对迪士尼相关文档进行高效检索与智能问答。系统采用了混合检索架构，集成了向量检索和关键词检索，确保在不同环境下都能提供高质量的检索服务。

### 核心功能

- **智能检索**：支持FAISS向量检索和关键词检索的混合检索模式
- **RAG生成**：接入阿里云百炼大模型，实现基于检索内容的智能问答
- **Web界面**：提供用户友好的Web交互界面，支持可视化操作
- **网络搜索**：可选集成网络搜索功能，补充知识库外的实时信息
- **一键部署**：提供自动化安装脚本，简化部署流程
- **知识库统计**：详细的知识库使用情况分析和检索效果评估

## 📊 知识库规模

- **总文件数**：59个文档
- **覆盖范围**：上海、东京、香港等多地迪士尼乐园信息
- **内容类别**：产品与服务、运营流程、应急预案、客户关系、内部知识
- **支持查询类型**：门票预订、酒店信息、游乐项目、餐饮选择、会员政策等

## 🛠️ 系统架构

### 1. 数据处理层

- **文档解析**：支持Word、PDF、PPT等多种格式文档的解析
- **智能切片**：基于语义和文档结构进行内容切片，保持语义完整性
- **元数据提取**：提取文档标题、来源、分类等元数据信息

### 2. 索引存储层

- **关键词索引**：基于倒排索引的快速关键词检索
- **FAISS向量索引**：使用sentence-transformers模型生成向量，支持语义检索
- **混合检索**：通过HybridRetriever模块融合多种检索结果

### 3. 应用服务层

- **命令行工具**：交互式检索助手，支持命令行查询
- **Web服务**：基于Flask的Web应用，提供图形化界面
- **RAG生成**：结合检索结果和大语言模型生成智能回答
- **网络搜索**：通过WebSearcher模块补充实时网络信息

## 🚀 快速开始

### 1. 环境准备

系统要求：
- Python 3.8+
- 推荐至少8GB内存
- 足够的磁盘空间存储模型和索引

### 2. 一键安装与运行

Windows用户可以直接运行自动化脚本：

```bash
# 双击运行或在命令行执行
install_and_run.bat
```

或者使用pip安装：

```bash
# 安装项目（开发模式）
pip install -e .

# 安装完整版依赖（可选）
pip install -e .[full]
```

### 3. 配置环境变量

复制`.env.example`文件为`.env`，并配置必要的API密钥（如需使用RAG生成功能）：

```
# 阿里云百炼API密钥（可选，用于RAG生成）
ALIYUN_BAILIAN_API_KEY=your_api_key_here
```

### 4. 启动应用

#### 命令行模式

```bash
# 使用命令行工具
disney-rag
```

#### Web界面模式

```bash
# 启动Web服务
disney-rag-web

# 或直接运行
python web界面/app.py
```

启动成功后，访问 http://127.0.0.1:5000 打开Web界面。

## 📁 文件结构说明

### 核心文件

- **迪士尼RAG检索助手FAISS版.py**：主程序，命令行交互入口
- **hybrid_retriever.py**：混合检索模块，结合多种检索策略
- **web_searcher.py**：网络搜索模块，补充实时信息
- **web界面/app.py**：Flask Web应用入口
- **setup.py**：项目安装配置
- **install_and_run.bat**：一键安装脚本

### 知识库文件

- **迪士尼RAG知识库/**：原始知识文档
  - **1-产品与服务详情/**：酒店、票务、游乐项目等信息
  - **2-运营流程与标准作业程序/**：客诉处理、预订流程等
  - **3-特殊情况与应急预案/**：紧急情况处理指南
  - **4-客户关系与支持话术/**：客户服务话术
  - **5-内部知识与工具/**：员工培训、岗位职责等

### 索引文件

- **final_index/**：预构建的搜索索引
  - `simple_index.json`：关键词倒排索引
  - `chunk_mapping.json`：切片内容映射
  - `vector_index.faiss`：FAISS向量索引（如果已生成）
  - `embeddings.npy`：文本嵌入向量（如果已生成）

## 💡 示例查询

以下是一些有效的测试查询示例：

### 1. 门票相关
- "上海迪士尼乐园的门票价格是多少？"
- "儿童票的购买条件和价格"
- "年卡会员有什么优惠政策？"
- "迪士尼乐园门票可以退吗？退款政策是什么？"

### 2. 住宿与餐饮
- "上海迪士尼乐园有哪些酒店？价格如何？"
- "迪士尼酒店的入住和退房时间是什么？"
- "园区内有哪些特色餐厅？"
- "迪士尼乐园内的餐饮价格贵吗？"

### 3. 游乐项目
- "上海迪士尼乐园最刺激的项目有哪些？"
- "适合小朋友的迪士尼游玩项目推荐"
- "适合老人的迪士尼游玩路线"
- "迪士尼乐园有哪些必玩项目？"

### 4. 运营与服务
- "迪士尼乐园的开闭园时间？"
- "烟花表演和巡游的时间安排"
- "园区内有哪些服务设施？"
- "导览员的工作职责是什么？"
- "迪士尼乐园的员工培训内容有哪些？"

### 5. 会员与福利
- "迪士尼乐园年票使用规则"
- "迪士尼乐园会员制度介绍"
- "会员专属福利有哪些？"

## 🔧 常见问题解答

### Q: 运行时遇到 `No module named 'retrieval_evaluator'` 错误怎么办？
A: 这个模块是可选的，不影响核心功能。如果需要完整功能，可以安装完整版依赖：`pip install -e .[full]`。

### Q: 如何更新知识库？
A: 将新文档放入"迪士尼RAG知识库"目录，重新运行系统即可自动更新索引。

### Q: 为什么没有RAG生成功能？
A: 需要配置有效的阿里云百炼API密钥。请在.env文件中设置`ALIYUN_BAILIAN_API_KEY`。

### Q: 如何优化检索结果？
A: 可以尝试以下方法：
- 使用更具体的查询关键词
- 安装完整版依赖以启用向量检索
- 调整查询中的关键词组合

### Q: Web服务无法启动怎么办？
A: 请检查：
- Python环境是否正确配置
- 所有依赖是否已安装
- 端口5000是否被占用

## 📈 知识库使用指南

### 最佳实践

1. **查询优化**：
   - 使用具体、明确的关键词
   - 避免过于宽泛的问题
   - 针对特定方面提问（如"上海迪士尼"而非"迪士尼"）

2. **结果评估**：
   - 查看检索结果的相关性分数
   - 注意信息来源和时间
   - 对于重要信息，建议交叉验证

3. **常见场景应用**：
   - **游客咨询**：门票、住宿、餐饮、游玩路线
   - **员工培训**：岗位职责、服务标准、操作流程
   - **内部查询**：政策文件、工作指南、应急预案

### 导览员工作职责详解

迪士尼乐园导览员是园区服务的重要组成部分，主要工作职责包括：

1. **游客引导与咨询**：
   - 提供园区地图和路线指引
   - 解答游客关于游乐设施、演出时间、餐饮购物等问题
   - 协助游客规划合理的游玩路线

2. **特殊需求协助**：
   - 为行动不便的游客提供必要帮助
   - 协助儿童、老人等特殊群体
   - 处理游客临时困难和突发情况

3. **信息传达**：
   - 及时向游客传达园区公告和特殊信息
   - 提醒游客注意事项和安全须知
   - 宣传园区活动和特色项目

4. **服务质量维护**：
   - 保持友好、专业的服务态度
   - 收集游客反馈和建议
   - 协助维护园区秩序和环境整洁

## � 功能扩展

### 未来规划

1. **多模态支持**：添加图片、视频等多媒体内容检索
2. **个性化推荐**：基于用户偏好提供定制化游玩建议
3. **多语言支持**：扩展为多语言知识库，服务国际游客
4. **移动端适配**：开发移动应用，提供更便捷的访问方式
5. **实时数据集成**：接入乐园实时数据，如排队时间、演出状态等

### 高级配置

系统支持通过环境变量进行高级配置：

```
# 模型缓存目录
TRANSFORMERS_CACHE=./custom_cache

# 日志级别
LOG_LEVEL=INFO

# 检索参数配置
TOP_K=5
```

---

*本指南由迪士尼RAG助手系统提供*
*更新时间：2024年7月*
